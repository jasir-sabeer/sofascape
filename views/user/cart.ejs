
<style>
  .input-group {
  display: flex;
  align-items: center;
  justify-content: center;
}

.input-number {
  width: 50px;
  text-align: center;
  border: 1px solid #ccc;
  height: 30px;
}

.btn {
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #f1f1f1;
  border: 1px solid #ccc;
  cursor: pointer;
}

.btn:hover {
  background-color: #fff;
}

.btn:active {
  background-color: #fff;
}

.btn-decrement {
  border-right: none;
}

.btn-increment {
  border-left: none;
}

</style>
<%-include("../partials/user/header")%>
  <!--================Home Banner Area =================-->
  <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Cart Products</h2>
                
                  <li style="float: left;" class="breadcrumb-item"><a href="/homepage">Home</a></li>
                  <li  style="float: left;" class="breadcrumb-item active" aria-current="page">Cart</li>
              
        
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->

  <!--================Cart Area =================-->
  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <%if(cartProducts.length>0){ %>
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity of Product</th>
                <th scope="col">Total</th>
                <th scope="col">Remove product</th>

              </tr>
            </thead>
            <tbody>
              
              <% cartProducts.forEach(product => { %>
              <tr>
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <img style="width: 2cm;height: 2cm;" src="/uploads/<%= product.productId.images[0] %>" alt="<%= product.productId.productname %>" />
                    </div>
                    <div class="media-body">
                      <p><%= product.productId.productname %></p>
                    </div>
                  </div>
                </td>
                <td>
                  <h5>₹<%= product.productId.regularprice %></h5>
                </td>
                <td>
                  <div class="product_count">
                      <div class="input-group">
                          
                          <button class="btn btn-decrement" onclick="updateQuantity('<%= product.productId._id %>', 'decrease')">-</button>
                          
                          <input 
                              class="input-number" 
                              type="number" 
                              value="<%= product.quantity %>" 
                              min="1" 
                              max="10" 
                              readonly 
                              data-product-id="<%= product.productId._id %>" />
                          
                          <button class="btn btn-increment" onclick="updateQuantity('<%= product.productId._id %>', 'increase')">+</button>
                      </div>
                  </div>
              </td>
                 <td>
                  <h5>₹<%= product.productId.regularprice * product.quantity %></h5>
                </td>
                <td>
                  <a href="#" class="genric-btn danger">Remove</a>
                </td>
              </tr>
              <%})%>
              
              
              <tr class="bottom_button">
                <td>
                  <a class="btn_1" href="/products">Update Cart</a>
                </td>
                <td></td>
                <td></td>
                <td>
                  <div class="cupon_text float-right">
                    <a class="btn_1"  href="#">Close Coupon</a>
                  </div>
                </td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Subtotal</h5>
                </td>
                <td>
                  <h5>₹<%=subtotal%></h5>
                </td>
              </tr>
        
            <% } else { %>
              <tr>
                <td colspan="4">Your cart is empty....! Please add products </td>
            </tr>
          </tbody>
            <% } %>
     
          </table>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1" href="/products">Continue Shopping</a>
            <% if ( cartProducts.length > 0) { %>
            <a class="btn_1 checkout_btn_1" href="#">Proceed to checkout</a>
            <% } else { %>
              <a class="btn_1 checkout_btn_1" href="#">Back to home</a>
              <% } %>
          </div>
        </div>
      </div>
  </section>
  <!--================End Cart Area =================-->

  <%-include("../partials/user/footer")%>
  <script>
  function updateQuantity(productId, action) {
    
    const inputField = document.querySelector(`.input-number[data-product-id="${productId}"]`);
    const currentValue = parseInt(inputField.value);
    const minValue = parseInt(inputField.min);
    const maxValue = parseInt(inputField.max);
    let newValue = currentValue;

    // Update quantity based on action
    if (action === 'increase') {
        newValue = Math.min(currentValue + 1, maxValue);
    } else if (action === 'decrease') {
        newValue = Math.max(currentValue - 1, minValue);
    }

    // Update the UI
    inputField.value = newValue;

    
    fetch('/cart/update-quantity', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ productId, quantity: newValue }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log("Quantity updated successfully:", data.products);
        } else {
          console.logT
        }
    })
    .catch(error => console.error("Error:", error));
}

</script>