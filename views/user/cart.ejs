
<style>
  .input-group {
  display: flex;
  align-items: center;
  justify-content: center;
}

.input-number {
  width: 50px;
  text-align: center;
  border: 1px solid #ccc;
  height: 30px;
}

.btn {
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #f1f1f1;
  border: 1px solid #ccc;
  cursor: pointer;
}

.product_count {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px; /* Small gap between elements */
}

.product_count .btn-decrease, 
.product_count .btn-increase {
  background-color: #fff; /* Blue color */
  color: #000; /* White text */
  border: none; /* No border */
  padding: 8px 12px; /* Add padding for better visibility */
  font-size: 18px; /* Larger font size for buttons */
  font-weight: bold;
  border-radius: 5px; /* Slightly rounded corners */
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.product_count .btn-decrease:hover, 
.product_count .btn-increase:hover {
  background-color: #fff; /* Darker blue on hover */
  transform: scale(1.1); /* Slight zoom effect */
}

.product_count .input-text {
  width: 60px; /* Compact width */
  height: 40px; /* Uniform height */
  text-align: center; /* Center-align the text */
  font-size: 16px; /* Adjusted font size */
  border: 1px solid #ccc; /* Light border */
  border-radius: 5px; /* Rounded corners */
  outline: none; /* No outline on focus */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow */
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.product_count .input-text:focus {
  border-color: #fff; /* Blue border on focus */
  box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3); /* Blue shadow on focus */
}

@media (max-width: 768px) {
  .product_count {
    flex-direction: column; /* Stack buttons and input vertically */
    gap: 10px; /* Increase spacing for smaller screens */
  }

  .product_count .btn-decrease, 
  .product_count .btn-increase, 
  .product_count .input-text {
    width: 100%; /* Full width for smaller screens */
  }
}


</style>
<%-include("../partials/user/header")%>
  <!--================Home Banner Area =================-->
  <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Cart Products</h2>
                
                  <li style="float: left;" class="breadcrumb-item"><a href="/homepage">Home</a></li>
                  <li  style="float: left;" class="breadcrumb-item active" aria-current="page">Cart</li>
              
        
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->

  <!--================Cart Area =================-->
  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <%if(cartProducts.length>0){ %>
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity of Product</th>
                <th scope="col">Total</th>
                <th scope="col">Remove product</th>

              </tr>
            </thead>
            <tbody>
              
              <% cartProducts.forEach(product => { %>
              <tr>
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <img style="width: 2cm;height: 2cm;" src="/uploads/<%= product.productId.images[0] %>" alt="<%= product.productId.productname %>" />
                    </div>
                    <div class="media-body">
                      <p><%= product.productId.productname %></p>
                    </div>
                  </div>
                </td>
                <td>
                  <% if (product.productId.discountPrice &&product.productId.discountPrice < product.productId.regularprice) { %>
                    <h5> ₹<%=Math.round(product.productId.discountPrice) %></h5>
                <% } else { %>
                    <h5>₹<%=product.productId.regularprice %></h5>
                <% } %>
                </td>
                <td>
                  <div class="product_count">
                    <button onclick="updateQuantity('decrease', '<%= product.productId._id %>')" 
                            class="btn-decrease" type="button">-</button>
                    <input type="text" name="qty" id="sst" maxlength="12" m value="<%= product.quantity %>" 
                           title="Quantity:" class="input-text qty" 
                           data-product-id="<%= product.productId._id %>">
                    <button onclick="updateQuantity('increase', '<%= product.productId._id %>')" 
                            class="btn-increase" type="button">+</button>
                  </div>
                </td>
                
                 <td>
                  <% if (product.productId.discountPrice && product.productId.discountPrice < product.productId.regularprice) { %>
                    <h5 id="price-<%- product.productId._id %>">₹<%= (product.productId.discountPrice * product.quantity).toFixed(0) %></h5>
                  <% } else { %>
                    <h5 id="price-<%- product.productId._id %>">₹<%= (product.productId.regularprice * product.quantity).toFixed(0) %></h5>
                  <% } %>
                  

                </td>

                <td>
                  <form action="/cart/cancel/<%= product.productId._id %>?_method=DELETE" method="POST"
                      onsubmit="event.preventDefault(); cancelProduct('<%= product.productId._id %>')">
                      <button class="genric-btn danger-border radius">Cancel</button>
                  </form>
              </td>
              </tr>
              <%})%>
              
              
              <tr class="bottom_button">
                <td>
                  <div class="cupon_text float-right">
                    <a class="btn_1"  href="#">Close Coupon</a>
                  </div>
                </td>
                <td></td>
                <td></td>
                <td>
                </td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Subtotal</h5>
                </td>
                <td>
                  <h5>₹<%=subtotal%></h5>
                </td>
              </tr>
        
            <% } else { %>
              <tr>
                <td colspan="4">Your cart is empty....! Please add products </td>
            </tr>
          </tbody>
            <% } %>
     
          </table>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1" href="/products">Continue Shopping</a>
            <% if ( cartProducts.length > 0) { %>
            <a class="btn_1 checkout_btn_1" href="/checkout">Proceed to checkout</a>
            <% } else { %>
              <a class="btn_1 checkout_btn_1" href="#">Back to home</a>
              <% } %>
          </div>
        </div>
      </div>
  </section>
  <!--================End Cart Area =================-->

  <%-include("../partials/user/footer")%>
 <!---update Quantity---->
 <script>
  function updateQuantity(action, productId) {
    
    const input = document.querySelector(`input[data-product-id="${productId}"]`); 
    const priceElement = document.querySelector(`#price-${productId}`); 
    let currentQty = parseInt(input.value);

    if (isNaN(currentQty)) {
        currentQty = 1; 
    }

    
    if (action === 'increase' && currentQty<10) {
        currentQty++;
    } else if (action === 'decrease' && currentQty > 1) {
        currentQty--;
    }

    input.value = currentQty;

    
    const data = {
        productId: productId,
        quantity: currentQty
    };

    
    fetch('/updateCart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            
            priceElement.textContent = `₹${data.newPrice}`;
            window.location.reload()
        } else {
            
            Swal.fire({
                title: "Message!",
                text: data.message,
                confirmButtonText: "Okay",
            });
        }
    })
    .catch(error => {
        console.log(error)
        Swal.fire({
            title: "Server Error!",
            text: "Something went wrong while updating the cart. Please try again later.",
            icon: "error",
            confirmButtonText: "Okay",
        });
    });
}


function cancelProduct(productId) {
    fetch(`/cart/cancel/${productId}`, { 
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
           
        }else{
          toastr.error("Cart Item Removed ", "Error");
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            const productRow = document.querySelector(`#product-${productId}`);
            window.location.reload()
            if (productRow) {
                productRow.remove();
            }
        } else {
            console.error('Error:', data.message);
        }
    })
    .catch(error => {
        console.error('Error canceling product:', error);
    });
}


</script>
